name: detect-changes

on:
  workflow_call:
    outputs:
      api:
        value: ${{ jobs.detect-changes.outputs.api }}
      ui:
        value: ${{ jobs.detect-changes.outputs.ui }}
      node:
        value: ${{ jobs.detect-changes.outputs.node }}
      host:
        value: ${{ jobs.detect-changes.outputs.host }}
      pipeline:
        value: ${{ jobs.detect-changes.outputs.pipeline }}
      blobtools:
        value: ${{ jobs.detect-changes.outputs.blobtools }}
      docker:
        value: ${{ jobs.detect-changes.outputs.docker }}
      all:
        value: ${{ jobs.detect-changes.outputs.all }}

jobs:
  detect-changes:
    name: Detect changes
    runs-on: ubuntu-latest
    outputs:
      api: ${{ steps.filter.outputs.api }}
      ui: ${{ steps.filter.outputs.ui }}
      node: ${{ steps.filter.outputs.node }}
      host: ${{ steps.filter.outputs.host }}
      pipeline: ${{ steps.filter.outputs.pipeline }}
      blobtools: ${{ steps.filter.outputs.blobtools }}
      docker: ${{ steps.filter.outputs.docker }}
      all: ${{ steps.filter.outputs.all }}
    steps:
      - uses: actions/checkout@v3
      - uses: dorny/paths-filter@v2
        id: filter
        with:
          filters: |
            api:
              - 'src/api/**'
            ui:
              - 'src/viewer/**'
              - 'src/packaged-viewer/**'
            node:
              - 'src/api/**'
              - 'src/viewer/**'
              - 'src/packaged-viewer/**'
            host:
              - 'src/blobtoolkit-host/**'
            pipeline:
              - 'src/blobtoolkit-pipeline/**'
            blobtools:
              - 'src/blobtoolkit-host/**'
              - 'src/blobtoolkit-pipeline/**'
              - 'src/blobtools/**'
              - 'src/btk/**'
            docker:
              - 'src/docker/**'
            blobtoolkit:
              - 'src/**'
